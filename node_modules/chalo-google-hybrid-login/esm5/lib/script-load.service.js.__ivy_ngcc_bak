/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable, Inject } from '@angular/core';
import { Observable } from 'rxjs';
import { take, shareReplay } from 'rxjs/operators';
import { DOCUMENT } from '@angular/common';
var ScriptLoadService = /** @class */ (function () {
    function ScriptLoadService(document) {
        this.document = document;
        this.scriptsLoaders = {};
    }
    /**
     *
     * @param url Url of the external script to be loaded
     * @param attributes Attribute list to be added to the script element
     * @param targetEl Target element for the placing script tag. It can be a selector or a element reference
     */
    /**
     *
     * @param {?} url Url of the external script to be loaded
     * @param {?=} attributes Attribute list to be added to the script element
     * @param {?=} targetEl Target element for the placing script tag. It can be a selector or a element reference
     * @return {?}
     */
    ScriptLoadService.prototype.loadScript = /**
     *
     * @param {?} url Url of the external script to be loaded
     * @param {?=} attributes Attribute list to be added to the script element
     * @param {?=} targetEl Target element for the placing script tag. It can be a selector or a element reference
     * @return {?}
     */
    function (url, attributes, targetEl) {
        var _this = this;
        if (targetEl === void 0) { targetEl = 'head'; }
        return this.scriptsLoaders[url] = this.scriptsLoaders[url] || new Observable(function (observer) {
            /** @type {?} */
            var script = _this.document.createElement('script');
            if (attributes) {
                for (var key in attributes) {
                    if (attributes.hasOwnProperty(key)) {
                        script.setAttribute(key, attributes[key]);
                    }
                }
            }
            script.onload = function (event) {
                console.log('onload', event);
                observer.next(event);
                observer.complete();
            };
            script.onerror = function (err) {
                console.log('sdad', err);
                observer.error(err);
            };
            script.src = url;
            /** @type {?} */
            var targetElement = typeof targetEl === 'string' ? _this.document.querySelector(targetEl) : targetEl;
            targetElement.appendChild(script);
        })
            .pipe(take(1), shareReplay(1));
    };
    ScriptLoadService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ScriptLoadService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    return ScriptLoadService;
}());
export { ScriptLoadService };
if (false) {
    /** @type {?} */
    ScriptLoadService.prototype.scriptsLoaders;
    /** @type {?} */
    ScriptLoadService.prototype.document;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LWxvYWQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NoYWxvLWdvb2dsZS1oeWJyaWQtbG9naW4vIiwic291cmNlcyI6WyJsaWIvc2NyaXB0LWxvYWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDakQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUMsSUFBSSxFQUFFLFdBQVcsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQzs7SUFLdkMsMkJBQXNDLFFBQWE7UUFBYixhQUFRLEdBQVIsUUFBUSxDQUFLOzhCQUsvQyxFQUFFO0tBSkw7SUFNRDs7Ozs7T0FLRzs7Ozs7Ozs7SUFDSCxzQ0FBVTs7Ozs7OztJQUFWLFVBQVcsR0FBVyxFQUFFLFVBQW9DLEVBQUUsUUFBdUM7UUFBckcsaUJBZ0NDO1FBaEM2RCx5QkFBQSxFQUFBLGlCQUF1QztRQUNuRyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksVUFBVSxDQUFRLFVBQUMsUUFBUTs7WUFDM0YsSUFBTSxNQUFNLEdBQXNCLEtBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXhFLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2YsR0FBRyxDQUFDLENBQUMsSUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQztvQkFDN0IsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ25DLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUMzQztpQkFDRjthQUNGO1lBRUQsTUFBTSxDQUFDLE1BQU0sR0FBRyxVQUFDLEtBQVk7Z0JBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUM3QixRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQixRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDckIsQ0FBQztZQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsVUFBQSxHQUFHO2dCQUNsQixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDekIsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNyQixDQUFDO1lBRUYsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7O1lBRWpCLElBQU0sYUFBYSxHQUFnQixPQUFPLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7WUFDbkgsYUFBYSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQyxDQUFDO2FBQ0QsSUFBSSxDQUNILElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQ2YsQ0FBQztLQUNIOztnQkFoREYsVUFBVTs7OztnREFHSSxNQUFNLFNBQUMsUUFBUTs7NEJBUjlCOztTQU1hLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZSwgSW5qZWN0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQge3Rha2UsIHNoYXJlUmVwbGF5fSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge0RPQ1VNRU5UfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU2NyaXB0TG9hZFNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgZG9jdW1lbnQ6IGFueSkge1xuICB9XG5cbiAgcHJpdmF0ZSBzY3JpcHRzTG9hZGVyczoge1xuICAgIFt1cmw6IHN0cmluZ106IE9ic2VydmFibGU8RXZlbnQ+XG4gIH0gPSB7fTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVybCBVcmwgb2YgdGhlIGV4dGVybmFsIHNjcmlwdCB0byBiZSBsb2FkZWRcbiAgICogQHBhcmFtIGF0dHJpYnV0ZXMgQXR0cmlidXRlIGxpc3QgdG8gYmUgYWRkZWQgdG8gdGhlIHNjcmlwdCBlbGVtZW50XG4gICAqIEBwYXJhbSB0YXJnZXRFbCBUYXJnZXQgZWxlbWVudCBmb3IgdGhlIHBsYWNpbmcgc2NyaXB0IHRhZy4gSXQgY2FuIGJlIGEgc2VsZWN0b3Igb3IgYSBlbGVtZW50IHJlZmVyZW5jZVxuICAgKi9cbiAgbG9hZFNjcmlwdCh1cmw6IHN0cmluZywgYXR0cmlidXRlcz86IHsgW3M6IHN0cmluZ106IHN0cmluZyB9LCB0YXJnZXRFbDogSFRNTEVsZW1lbnQgfCBzdHJpbmcgPSAnaGVhZCcpOiBPYnNlcnZhYmxlPEV2ZW50PiB7XG4gICAgcmV0dXJuIHRoaXMuc2NyaXB0c0xvYWRlcnNbdXJsXSA9IHRoaXMuc2NyaXB0c0xvYWRlcnNbdXJsXSB8fCBuZXcgT2JzZXJ2YWJsZTxFdmVudD4oKG9ic2VydmVyKSA9PiB7XG4gICAgICBjb25zdCBzY3JpcHQ6IEhUTUxTY3JpcHRFbGVtZW50ID0gdGhpcy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblxuICAgICAgaWYgKGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICAgIGlmIChhdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoa2V5LCBhdHRyaWJ1dGVzW2tleV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzY3JpcHQub25sb2FkID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnb25sb2FkJywgZXZlbnQpO1xuICAgICAgICBvYnNlcnZlci5uZXh0KGV2ZW50KTtcbiAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgIH07XG5cbiAgICAgIHNjcmlwdC5vbmVycm9yID0gZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ3NkYWQnLCBlcnIpO1xuICAgICAgICBvYnNlcnZlci5lcnJvcihlcnIpO1xuICAgICAgfTtcblxuICAgICAgc2NyaXB0LnNyYyA9IHVybDtcblxuICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQgPSB0eXBlb2YgdGFyZ2V0RWwgPT09ICdzdHJpbmcnID8gdGhpcy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldEVsKSA6IHRhcmdldEVsO1xuICAgICAgdGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgIH0pXG4gICAgLnBpcGUoXG4gICAgICB0YWtlKDEpLFxuICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICApO1xuICB9XG59XG4iXX0=