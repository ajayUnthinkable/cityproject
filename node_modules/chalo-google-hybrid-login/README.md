# Chalo Google Hybrid Login

This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 6.2.9. This project implements hybrid server-side flow for google SignIn and phone number SignIn. It gives JWT token and refresh_token from Chalo server. JWT token contains user’s roles information.

## Installation
```npm install chalo-google-hybrid-login --save```

## Usage


````ts
// environment.ts

import {GoogleLoginConfig} from "chalo-google-hybrid-login";

export const environment = {
  production: false,
  base_url: `API base URL`,
  redirect_uri:'Redirect URI'
};

export const googleConfig: GoogleLoginConfig = {
  authCodeUrl: `${environment.base_url}google/token?webRequest=true&redirect_uri=${environment.redirect_uri}`,
  userTokenServerUrl: `${environment.base_url.split('api')[0]}oauth/token`,
  sendOtpUrl:`${environment.base_url}signin/sendOtp`,
  validateOtpUrl:`${environment.base_url}signin/validateOtp`,
  auth: {
    google: {
      client_id: <client ID>
    },
    server: {
      client_id: <client ID>, client_secret: <client Secret>
    }
  },
  user:{
    userCookie:<userCookie name>,
    authenticateUserUrl:<authenticate API Url>,
    loginStateCookie:< loginStateCookie>

  },
  logout:{
    logoutUrl:<logout API Url>
  }
};
````

````ts
// app.module.ts
import {GOOGLE_LOGIN_CONFIG,GoogleLoginService} from "chalo-google-hybrid-login";
import {googleConfig} from "../environments/environment";

...
@NgModule({
    imports: [
        ...
    ],
    providers: [
        {provide: GOOGLE_LOGIN_CONFIG, useValue: googleConfig}
         GoogleLoginService]
    ...
})
export class AppModule { }
````


````ts
// login.module.ts
import {ChaloGoogleHybridLoginModule} from "chalo-google-hybrid-login";
...
@NgModule({
    imports: [
        ...
        ChaloGoogleHybridLoginModule
        ...
    ],
    ...
})
export class LoginModule { }
````

````ts
// login.component.ts
import {GoogleLoginResponse} from "chalo-google-hybrid-login";
...
@Component({
  selector: 'app-login',
  template: `
    <div>
        <chalo-google-hybrid-login (onLoginResponse)="onLoginResponse($event)"></chalo-google-hybrid-login>
    </div>
  `,
  styleUrls: ['./login.scss']
})
export class LoginComponent {
  constructor() {
  }

  onLoginResponse(response: GoogleLoginResponse) {
    // response consists of code and data
    // code provides status either 0 or 1 for Success and failure respectively
    // data provides JWT token and refresh_token from Chalo server. JWT token contains user’s roles information.
  }
}
````

````ts
//For using custom interceptor for the HttpClient requests, Provide GOOGLE_LOGIN_HTTP_INTERCEPTOR with class which implements HttpInterceptor
// app.module.ts
import {GOOGLE_LOGIN_HTTP_INTERCEPTOR} from "chalo-google-hybrid-login";
...
@NgModule({
    imports: [
        ...
    ],
    providers: [
        {provide: GOOGLE_LOGIN_HTTP_INTERCEPTOR, useClass: <ServerErrorInterceptor Class>},
        ]
    ...
})
export class AppModule { }
````

## Functions

| Name              | Parameter              | Return Type |Description                                                                                                                                        |
| ----------------- | ----------------- | ----------------- |-------------------------------------------------------------------------------------------------------------------------------------------------- |
| getUserTokenFromRefreshToken      | refresh token | Observable | Function to get new Jwt user token from Central Auth after the previous token expires.


## SSO Implementation

##### For SSO Implementation this library uses ngx-cookie-service to set,get and delete cookie for domain chalo.com .

## Functions

| Name              | Return Type              | Description                                                                                                                                        |
| ----------------- | ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| isUserAuthenticated      | Boolean | Function to check if user is already Authenticated. Returns Boolean .True if User is already authenticated and False if not authenticated. 
| getGoogleLoginResponse | Observable | Function to get Google Login Response if User is already Authenticated. Returns an Observable.response consists of code and data.code provides status either 0 or 1 for Success and failure respectively. data provides JWT token and refresh_token from Chalo server. JWT token contains user’s roles information.      
| logoutUser     | Observable | Function to logout User. 


## SLO Implementation

````ts
import { Component } from '@angular/core';
import { GoogleLoginService } from "chalo-google-hybrid-login";
import { Subscription } from 'rxjs';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})

export class AppComponent {
  subscription: Subscription;

  constructor(private googleLoginService: GoogleLoginService<any>) {
    this.subscription = this.googleLoginService.getLogoutMessage().subscribe(msg => {
      if (msg.message === 'Signed out') {
        //perform logout
      }
    })
  }

  ngOnDestroy() {
    // unsubscribe to ensure no memory leaks
    this.subscription.unsubscribe();
  }
}
````

## Mobile Login Implementation
````hasMobileLogin | boolean````

## User Login Implementation
````
hasUserLogin | boolean

<chalo-google-hybrid-login [hasUserLogin]="true"></chalo-google-hybrid-login>

//enviornment.ts
validateUserUrl: `${environment.CENTRAL_AUTH_URL}signin/validate/credentials`,
````
