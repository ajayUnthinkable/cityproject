import { Component, Input, Output, EventEmitter } from '@angular/core';
import * as moment from 'moment';
import * as _ from 'lodash';
export class GenericListFilterComponent {
    constructor() {
        this.onFilterChange = new EventEmitter();
        this.selectedValues = [];
        this.selectedCategory = {
            type: '',
            value: ''
        };
        this.isFiltersApplied = false;
        this.openFilterBar = false;
        this.timeFilter = false;
        this.searchKey = '';
        this.isCountClicked = false;
        this.isData = false;
        this.isStatus = false;
    }
    ngOnInit() {
    }
    ngOnChanges() {
        //Called before any other lifecycle hook. Use it to inject dependencies, but avoid any serious work here.
        //Add '${implements OnChanges}' to the class.
        setTimeout(() => {
            this.filterKeys1 = Object.keys(this.list);
            this.selectedFilterTabType1 = this.filterKeys1[0];
            this.fromTime = this.paramList.fromTime;
            this.toTime = this.paramList.toTime;
            this.listCopy = JSON.parse(JSON.stringify(this.list));
            this.isStatus = this.list.isStatus;
            this.category = this.list.category;
            this.isData = true;
        }, 2000);
    }
    openFilterSideBar() {
        this.searchKey = '';
        this.list[this.selectedFilterTabType1] = this.listCopy[this.selectedFilterTabType1];
        this.openFilterBar = !this.openFilterBar;
    }
    onCancel() {
        this.openFilterBar = false;
    }
    onRemoveFilter(item) {
        if (item == 'time') {
            this.fromTime = moment().subtract(3, 'hours').format('LT');
            this.toTime = moment().format('LT');
            this.timeFilter = false;
        }
        delete this.allAppliedFilters[item];
        this.selectedValues = this.selectedValues.filter(obj => {
            return obj.type !== item;
        });
        console.log(item, this.allAppliedFilters, this.selectedValues);
        this.applyFilters();
    }
    applyFilters() {
        this.isFiltersApplied = true;
        this.openFilterBar = false;
        let allAppliedFilters = {};
        this.selectedValues.forEach(item => {
            allAppliedFilters[item.type] = item.value;
        });
        if (this.timeFilter) {
            allAppliedFilters['time'] = `${this.fromTime} to ${this.toTime}`;
        }
        console.log(allAppliedFilters);
        this.allAppliedFilters = allAppliedFilters;
        this.filterKeys = Object.keys(this.allAppliedFilters);
        this.filterChange();
    }
    setTime(type, event) {
        this.timeFilter = true;
        if (type === "fromTime") {
            this.fromTime = event;
        }
        else {
            this.toTime = event;
        }
        ;
    }
    filterChange() {
        let filters = {
            isFilter: true,
            appliedFilterValues: this.allAppliedFilters,
            fromTime: this.timeFilter ? this.fromTime : '',
            toTime: this.timeFilter ? this.toTime : ''
        };
        console.log(filters);
        this.onFilterChange && this.onFilterChange.emit(filters);
    }
    openRestAppliedFilters() {
        this.isCountClicked = true;
    }
    selectedFilterTab(type) {
        this.searchKey = '';
        let indx = _.findIndex(this.selectedValues, (item) => {
            return item.type == type;
        });
        if (indx > -1) {
            this.selectedCategory = { type: type, value: this.selectedValues[indx].value };
            this.selectFilter(this.selectedCategory.value, this.selectedCategory.type);
        }
        this.selectedFilterTabType1 = type;
    }
    isFilterExists(filter) {
        let indx = _.findIndex(this.selectedValues, (item) => {
            return item.type == filter && item.value;
        });
        if (indx > -1) {
            return true;
        }
    }
    selectFilter(item, type) {
        let value = {
            type: type,
            value: item
        };
        let indx = _.findIndex(this.selectedValues, (item) => {
            return item.type == type;
        });
        if (indx > -1) {
            this.selectedValues[indx].value = item;
            this.selectedCategory = { type: type, value: this.selectedValues[indx].value };
        }
        else {
            this.selectedValues.push(value);
            this.selectedCategory = { type: type, value: item };
        }
        console.log(this.selectedValues, this.selectedCategory);
    }
    resetAllFilters() {
        this.fromTime = moment().subtract(3, 'hours').format('LT');
        this.toTime = moment().format('LT');
        this.isFiltersApplied = false;
        this.timeFilter = false;
        this.openFilterBar = false;
        this.searchKey = '';
        this.filterKeys = '';
        this.allAppliedFilters = {};
        this.selectedValues = [];
        this.selectedFilterTabType1 = this.filterKeys1[0];
        this.selectedCategory = {
            type: '',
            value: ''
        };
        this.isCountClicked = false;
        this.filterChange();
    }
    filterData(searchValue) {
        this.list[this.selectedFilterTabType1] = this.listCopy[this.selectedFilterTabType1];
        let filterArr = this.list[this.selectedFilterTabType1];
        if (filterArr && filterArr.length) {
            const data = filterArr.filter((item) => {
                return (item.toLowerCase().startsWith(searchValue.trim().toLowerCase()));
            });
            console.log(this.searchKey, searchValue, "data=>" + data, this.list[this.selectedFilterTabType1]);
            this.list[this.selectedFilterTabType1] = [...data];
        }
    }
}
GenericListFilterComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-filter',
                template: "<div class=\"dispatch-filters display-flex\">\n    <div class=\"display-flex\">\n      <div *ngIf=\"filterKeys?.length\"\n        [ngClass]=\"(filterKeys.length>2)?'filter-list-container-2 flex-wrap':'filter-list-container-2'\">\n        <ng-container *ngIf=\"isCountClicked\">\n          <div class=\"filter-list\" *ngFor=\"let item of filterKeys;let i = index\">\n            <span class=\"filter-list-data\"> {{item | titlecase}} : {{allAppliedFilters[item]}} </span>\n            <span (click)=\"onRemoveFilter(item)\" class=\"cancle-icon\">\n              x\n            </span>\n          </div>\n        </ng-container>\n  \n  \n        <div class=\"filter-list\" *ngIf=\"!isCountClicked\">\n          <span  class=\"filter-list-data\"> {{filterKeys[0] | titlecase}} : {{allAppliedFilters[filterKeys[0]]}} </span>\n          <span (click)=\"onRemoveFilter(filterKeys[0])\" class=\"cancle-icon\">\n            x\n          </span>\n        </div>\n  \n        <div class=\"filter-list\" *ngIf=\"filterKeys?.length >= 2 && !isCountClicked\">\n          <span  class=\"filter-list-data\"> {{filterKeys[1] | titlecase}} : {{allAppliedFilters[filterKeys[1]]}} </span>\n          <span (click)=\"onRemoveFilter(filterKeys[1])\" class=\"cancle-icon\">\n            x\n          </span>\n        </div>\n  \n        <div (click)=\"openRestAppliedFilters()\" class=\"filter-list cr-ptr\"\n          *ngIf=\"filterKeys.length > 2 && !isCountClicked\">\n          +{{filterKeys.length - 2}}\n        </div>\n  \n      </div>\n      <span\n        class=\"filter-color\"\n        (click)=\"openFilterSideBar()\">\n        <i class=\"fa fa-filter fa-2x icon-margin\"></i>\n        <!-- <span *ngIf=\"totalFilterCount\">({{totalFilterCount}})</span>  -->\n      </span>\n    </div>\n  \n    <div *ngIf=\"openFilterBar\" class=\"filter-position-modal\">\n      <div class=\"modalbody ele\">\n        <div>\n          <div class=\"header-item\">\n            <div>\n              Filter\n            </div>\n            <div class=\"cr-ptr\">\n              <span (click)=\"resetAllFilters()\" class=\"reset-filter\">Reset</span>\n              <span (click)=\"onCancel()\"><img class=\"cancle-icon-1\" src=\"./../../assets/images/crossIcon.png\"></span>\n            </div>\n          </div>\n          <hr>\n  \n          <div class=\"main-body\">\n            <div class=\"side-bar-wrapper\">\n              <div class=\"filter-side-menu\">\n                <div \n                *ngFor=\"let filter of filterKeys1\"  \n                [class.selected]=\"selectedFilterTabType1 === filter || isFilterExists(filter)\"\n                (click)=\"selectedFilterTab(filter)\" class=\"side-menu-tabs\">\n                    {{filter | titlecase}}\n                </div>\n  \n                <div *ngIf=\"paramList?.fromTime && paramList?.toTime\"\n                [class.selected]=\"selectedFilterTabType1 === 'time' || timeFilter\" (click)=\"selectedFilterTab('time')\"\n                class=\"side-menu-tabs\">\n                Select Time\n               </div>\n              </div>\n            </div>\n  \n            <div class=\"vl\"></div>\n  \n            <div class=\"filter-list-wrapper\">\n              <div style=\"margin-left: 22px;\" *ngIf=\"selectedFilterTabType1 !== 'time'\">\n              <input class=\"filter-search-option\" type=\"text\" placeholder=\"Search {{selectedFilterTabType1}}\" matInput\n                [(ngModel)]=\"searchKey\" (keyup)=\"filterData(searchKey)\" />\n             </div>\n              <div  [ngClass]=\"(list[selectedFilterTabType1]?.length > 6) ? 'filter-data-list-scroll-2 filter-data-list' : 'filter-data-list'\">\n                <div \n                *ngFor=\"let item of list[selectedFilterTabType1]\"\n                class=\"filter-content\"\n                (click)=\"selectFilter(item,selectedFilterTabType1)\"\n                [class.selected]=\"selectedCategory.value === item\"\n                >\n                    {{item}}\n                </div>\n  \n                <div *ngIf=\"paramList.selectedTab > 0 && selectedFilterTabType1=='live status'\"\n                [ngClass]=\"(liveStatus?.length > 6) ? 'filter-data-list-scroll-2 filter-data-list' : 'filter-data-list'\">\n                <div (click)=\"selectFilter(item,'live status')\" [class.selected]=\"selectedCategory.value.value === item.value\"\n                  *ngFor=\"let item of liveStatus\" class=\"filter-content\">\n                  {{item.name}}\n                </div>\n                </div>\n  \n                <ng-container *ngIf=\"paramList?.fromTime && paramList?.toTime && selectedFilterTabType1 === 'time'\">\n                  <div *ngIf=\"selectedFilterTabType === 'time'\" class=\"filter-data-list\">\n                    <div class=\"time-input-wrapper\">\n                      <label>From Time</label>\n                      <input matInput class=\"filter-time-input\" [(ngModel)]=\"fromTime\" [ngxTimepicker]=\"picker2\"\n                        placeholder=\"From Time\" readonly>\n                      <ngx-material-timepicker (timeSet)=\"setTime('fromTime',$event)\" #picker2></ngx-material-timepicker>\n                    </div>\n    \n                    <div class=\"time-input-wrapper\">\n                      <label>To Time</label>\n                      <input style=\"margin-left: 26px;\" matInput class=\"filter-time-input\" [(ngModel)]=\"toTime\"\n                        [ngxTimepicker]=\"picker3\" placeholder=\"To Time\" readonly>\n                      <ngx-material-timepicker (timeSet)=\"setTime('toTime',$event)\" #picker3></ngx-material-timepicker>\n                    </div>\n                  </div>\n                </ng-container>\n  \n  \n              </div>\n             \n              <div class=\"apply-btn\">\n                <button (click)=\"applyFilters()\" class=\"app-btn\">\n                  <span>Apply</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  ",
                styles: [".filter-modal-position-2{position:absolute;right:630px;top:109px}.filter-modal-position{position:absolute;right:474px;top:104px}.filter-modal-position-1{position:absolute;right:729px;top:109px}.modalbody{-moz-box-shadow:0 0 16px 0 rgba(0,0,0,.75);-webkit-box-shadow:0 0 16px 0 rgba(0,0,0,.75);background-color:#fff;border-radius:4px;box-shadow:0 0 16px 0 rgba(0,0,0,.75);display:flex;flex-direction:column;font-size:15px;height:400px;overflow:auto;position:fixed;width:400px;z-index:4}.ele{-webkit-animation:fadeIn .3s;-webkit-animation-fill-mode:forwards;animation:fadeIn .3s;animation-fill-mode:forwards;visibility:hidden}@-webkit-keyframes fadeIn{0%{opacity:0}to{opacity:1;visibility:visible}}@keyframes fadeIn{0%{opacity:0}to{opacity:1;visibility:visible}}.cancle-icon-1:hover{background-color:#f1f1f1;border-radius:50%;box-shadow:0 0 0 6px #f1f1f1}.header-item{display:flex;font-size:medium;justify-content:space-between;padding:10px 20px 0}.vl{border-left:1px solid grey;height:-webkit-fill-available;left:30%;margin-left:-4px;margin-top:38px;position:absolute;top:0}hr{margin-bottom:0}.side-menu-tabs{cursor:pointer;padding:14px 14px 14px 16px;width:116px}.side-menu-tabs:hover{background-color:#f1f1f1;color:#f28100}.side-bar-wrapper{width:117px}.main-body{display:flex}.filter-list-wrapper{width:100%}.filter-data-list{padding:10px}.filter-data-list-scroll-2{max-height:275px;overflow-y:scroll;padding:10px}.filter-content{cursor:pointer;padding:10px}.filter-content:hover{width:100%}.filter-content:hover,.filter-data-list .filter-content.selected{background-color:#f1f1f1;color:#f28100}.cr-ptr{cursor:pointer}.cr-ptr,.filter-side-menu .side-menu-tabs.selected{color:#f28100}.reset-filter{color:#f28100;margin-right:10px}.reset-filter:hover{background-color:#f1f1f1;border-radius:0;box-shadow:0 0 0 6px #f1f1f1}.filter-time-input{background:transparent;border:none;border-bottom:1px solid #999;font-size:14px;height:30px!important;height:30px;margin-left:8px;outline:none;padding:13px 9px;width:150px!important}.time-input-wrapper{padding:10px 0}.icon-margin{margin-right:10px;margin-top:-1px}.apply-btn{bottom:10px;position:absolute;right:12px}.filter-search-option{border:none;border-bottom:1px solid #f28100;font-size:14px;margin-bottom:5px;margin-right:20px;outline:none;padding-bottom:5px;padding-top:8px;width:-webkit-fill-available}.filter-list{border:1px solid #f28100;border-radius:12px;color:#000;display:flex;font-size:10px;height:26px;margin:2px;padding:3px 8px}.filter-list-data{-webkit-box-orient:vertical;-webkit-line-clamp:1;display:-webkit-box;overflow:hidden;text-overflow:ellipsis;width:125px}.filter-list-container-2{color:#f28100;display:flex;margin-left:auto;margin-right:5px;margin-top:-1px}.flex-wrap{flex-wrap:wrap;justify-content:flex-end;max-width:385px}.cancle-icon{color:#f28100;cursor:pointer;font-size:14px;font-size:13px;font-weight:700;font-weight:500;padding-left:5px;position:relative;top:-1px}.cancle-icon img{width:9px}.display-flex{display:flex}.filter-icon-position{color:#f28100;padding-right:15px}.filter-icon-position i{cursor:pointer}.filter-lst-show{display:flex;margin-left:auto}.filter-modal-position-3{position:absolute;right:569px;top:109px}.filter-color{color:#f28100;cursor:pointer}.dispatch-filters{position:relative}.dispatch-filters .filter-position-modal{position:absolute;right:430px;top:24px}"]
            },] }
];
GenericListFilterComponent.ctorParameters = () => [];
GenericListFilterComponent.propDecorators = {
    list: [{ type: Input }],
    paramList: [{ type: Input }],
    onFilterChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJpYy1saXN0LWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvZGFmZm9sYXAtOTM1L0Rlc2t0b3AvZ2VuZXJpYy1saXN0LWZpbHRlci9wcm9qZWN0cy9nZW5lcmljLWxpc3QtZmlsdGVyL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9nZW5lcmljLWxpc3QtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFHLE1BQU0sZUFBZSxDQUFDO0FBQ2hGLE9BQU8sS0FBSyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQ2pDLE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBTzVCLE1BQU0sT0FBTywwQkFBMEI7SUFnQ3JDO1FBN0JVLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUs5QyxtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNwQixxQkFBZ0IsR0FBRztZQUNqQixJQUFJLEVBQUMsRUFBRTtZQUNQLEtBQUssRUFBQyxFQUFFO1NBQ1QsQ0FBQztRQU1GLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixrQkFBYSxHQUFZLEtBQUssQ0FBQztRQUMvQixlQUFVLEdBQVksS0FBSyxDQUFDO1FBSTVCLGNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUN2QixXQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ2YsYUFBUSxHQUFHLEtBQUssQ0FBQztJQUtELENBQUM7SUFFakIsUUFBUTtJQUNSLENBQUM7SUFFRCxXQUFXO1FBQ1QseUdBQXlHO1FBQ3pHLDZDQUE2QztRQUM3QyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQyxJQUFJLENBQUMsc0JBQXNCLEdB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RyxLQUFLLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFRCxVQUFVLENBQUMsV0FBWTtRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDcEYsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN2RCxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxFQUFFO1lBQ2pDLE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDckMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMzRSxDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBQyxXQUFXLEVBQUMsUUFBUSxHQUFDLElBQUksRUFBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUE7WUFDNUYsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDcEQ7SUFDSCxDQUFDOzs7WUF6TUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxZQUFZO2dCQUN0Qiw0NkxBQXNDOzthQUV2Qzs7OzttQkFFRSxLQUFLO3dCQUNMLEtBQUs7NkJBQ0wsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLWZpbHRlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9maWx0ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9maWx0ZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBHZW5lcmljTGlzdEZpbHRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGxpc3Q7XG4gIEBJbnB1dCgpIHBhcmFtTGlzdDtcbiAgQE91dHB1dCgpIG9uRmlsdGVyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cbiAgZmlsdGVyS2V5czE7XG4gIHNlbGVjdGVkRmlsdGVyVGFiVHlwZTE7IFxuICBzZWxlY3RlZFZhbHVlcyA9IFtdO1xuICBzZWxlY3RlZENhdGVnb3J5ID0ge1xuICAgIHR5cGU6JycsXG4gICAgdmFsdWU6JydcbiAgfTtcbiAgZmlsdGVycztcbiAgbGlzdENvcHk7XG5cblxuICBmaWx0ZXJLZXlzO1xuICBpc0ZpbHRlcnNBcHBsaWVkID0gZmFsc2U7XG4gIG9wZW5GaWx0ZXJCYXI6IGJvb2xlYW4gPSBmYWxzZTtcbiAgdGltZUZpbHRlcjogYm9vbGVhbiA9IGZhbHNlO1xuICBhbGxBcHBsaWVkRmlsdGVycztcbiAgZnJvbVRpbWU7XG4gIHRvVGltZTtcbiAgc2VhcmNoS2V5ID0gJyc7XG4gIGlzQ291bnRDbGlja2VkID0gZmFsc2U7XG4gIGlzRGF0YSA9IGZhbHNlO1xuICBpc1N0YXR1cyA9IGZhbHNlO1xuICBzdGVwO1xuICBjYXRlZ29yeTtcblxuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICAvL0NhbGxlZCBiZWZvcmUgYW55IG90aGVyIGxpZmVjeWNsZSBob29rLiBVc2UgaXQgdG8gaW5qZWN0IGRlcGVuZGVuY2llcywgYnV0IGF2b2lkIGFueSBzZXJpb3VzIHdvcmsgaGVyZS5cbiAgICAvL0FkZCAnJHtpbXBsZW1lbnRzIE9uQ2hhbmdlc30nIHRvIHRoZSBjbGFzcy5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZmlsdGVyS2V5czEgPSBPYmplY3Qua2V5cyh0aGlzLmxpc3QpO1xuICAgICAgdGhpcy5zZWxlY3RlZEZpbHRlclRhYlR5cGUxID0gdGhpcy5maWx0ZXJLZXlzMVswXTtcbiAgICAgIHRoaXMuZnJvbVRpbWUgPSB0aGlzLnBhcmFtTGlzdC5mcm9tVGltZTtcbiAgICAgIHRoaXMudG9UaW1lID0gdGhpcy5wYXJhbUxpc3QudG9UaW1lO1xuICAgICAgdGhpcy5saXN0Q29weSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5saXN0KSkgO1xuICAgICAgdGhpcy5pc1N0YXR1cyA9IHRoaXMubGlzdC5pc1N0YXR1cztcbiAgICAgIHRoaXMuY2F0ZWdvcnkgPSB0aGlzLmxpc3QuY2F0ZWdvcnk7XG4gICAgICB0aGlzLmlzRGF0YSA9IHRydWU7XG4gICAgfSwgMjAwMCk7XG4gIH1cblxuICBvcGVuRmlsdGVyU2lkZUJhcigpIHtcbiAgICB0aGlzLnNlYXJjaEtleSA9ICcnO1xuICAgIHRoaXMubGlzdFt0aGlzLnNlbGVjdGVkRmlsdGVyVGFiVHlwZTFdID0gdGhpcy5saXN0Q29weVt0aGlzLnNlbGVjdGVkRmlsdGVyVGFiVHlwZTFdO1xuICAgIHRoaXMub3BlbkZpbHRlckJhciA9ICF0aGlzLm9wZW5GaWx0ZXJCYXI7XG4gIH1cblxuICBvbkNhbmNlbCgpIHtcbiAgICB0aGlzLm9wZW5GaWx0ZXJCYXIgPSBmYWxzZTtcbiAgfVxuXG5cblxuICBvblJlbW92ZUZpbHRlcihpdGVtKSB7XG4gICAgaWYgKGl0ZW0gPT0gJ3RpbWUnKSB7XG4gICAgICB0aGlzLmZyb21UaW1lID0gbW9tZW50KCkuc3VidHJhY3QoMywgJ2hvdXJzJykuZm9ybWF0KCdMVCcpO1xuICAgICAgdGhpcy50b1RpbWUgPSBtb21lbnQoKS5mb3JtYXQoJ0xUJyk7XG4gICAgICB0aGlzLnRpbWVGaWx0ZXIgPSBmYWxzZTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuYWxsQXBwbGllZEZpbHRlcnNbaXRlbV07XG4gICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuZmlsdGVyKG9iaiA9PiB7XG4gICAgICByZXR1cm4gb2JqLnR5cGUgIT09IGl0ZW07XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coaXRlbSx0aGlzLmFsbEFwcGxpZWRGaWx0ZXJzLHRoaXMuc2VsZWN0ZWRWYWx1ZXMpO1xuICAgIHRoaXMuYXBwbHlGaWx0ZXJzKCk7XG4gIH1cblxuXG5cbiAgYXBwbHlGaWx0ZXJzKCkge1xuICAgIHRoaXMuaXNGaWx0ZXJzQXBwbGllZCA9IHRydWU7XG4gICAgdGhpcy5vcGVuRmlsdGVyQmFyID0gZmFsc2U7XG4gICAgbGV0IGFsbEFwcGxpZWRGaWx0ZXJzID0ge307XG4gICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgYWxsQXBwbGllZEZpbHRlcnNbaXRlbS50eXBlXSA9IGl0ZW0udmFsdWU7XG4gICAgfSk7XG4gIFxuICAgIGlmICh0aGlzLnRpbWVGaWx0ZXIpIHtcbiAgICAgIGFsbEFwcGxpZWRGaWx0ZXJzWyd0aW1lJ10gPSBgJHt0aGlzLmZyb21UaW1lfSB0byAke3RoaXMudG9UaW1lfWA7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGFsbEFwcGxpZWRGaWx0ZXJzKTtcbiAgICB0aGlzLmFsbEFwcGxpZWRGaWx0ZXJzID0gYWxsQXBwbGllZEZpbHRlcnM7XG4gICAgdGhpcy5maWx0ZXJLZXlzID0gT2JqZWN0LmtleXModGhpcy5hbGxBcHBsaWVkRmlsdGVycyk7XG4gICAgdGhpcy5maWx0ZXJDaGFuZ2UoKTtcbiAgfVxuXG4gIHNldFRpbWUodHlwZTogc3RyaW5nLCBldmVudCkge1xuICAgIHRoaXMudGltZUZpbHRlciA9IHRydWU7XG4gICAgaWYgKHR5cGUgPT09IFwiZnJvbVRpbWVcIikge1xuICAgICAgdGhpcy5mcm9tVGltZSA9IGV2ZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRvVGltZSA9IGV2ZW50O1xuICAgIH07XG4gIH1cblxuXG4gIGZpbHRlckNoYW5nZSgpIHtcbiAgICBsZXQgZmlsdGVycyA9IHtcbiAgICAgIGlzRmlsdGVyOiB0cnVlLFxuICAgICAgYXBwbGllZEZpbHRlclZhbHVlczp0aGlzLmFsbEFwcGxpZWRGaWx0ZXJzLFxuICAgICAgZnJvbVRpbWUgOiB0aGlzLnRpbWVGaWx0ZXIgPyB0aGlzLmZyb21UaW1lIDogJycsXG4gICAgICB0b1RpbWUgOiB0aGlzLnRpbWVGaWx0ZXIgPyB0aGlzLnRvVGltZSA6ICcnXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGZpbHRlcnMpO1xuICAgIHRoaXMub25GaWx0ZXJDaGFuZ2UgJiYgdGhpcy5vbkZpbHRlckNoYW5nZS5lbWl0KGZpbHRlcnMpO1xuICB9XG5cbiAgb3BlblJlc3RBcHBsaWVkRmlsdGVycygpIHtcbiAgICB0aGlzLmlzQ291bnRDbGlja2VkID0gdHJ1ZTtcbiAgfVxuXG5cbiAgc2VsZWN0ZWRGaWx0ZXJUYWIodHlwZSkge1xuICAgIHRoaXMuc2VhcmNoS2V5ID0gJyc7XG4gICAgbGV0IGluZHggPSBfLmZpbmRJbmRleCh0aGlzLnNlbGVjdGVkVmFsdWVzLChpdGVtKSA9PiB7XG4gICAgICByZXR1cm4gaXRlbS50eXBlID09IHR5cGU7XG4gICAgfSk7XG4gICAgaWYoaW5keCA+IC0xKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkQ2F0ZWdvcnkgPSB7dHlwZTp0eXBlLHZhbHVlOnRoaXMuc2VsZWN0ZWRWYWx1ZXNbaW5keF0udmFsdWV9O1xuICAgICAgdGhpcy5zZWxlY3RGaWx0ZXIodGhpcy5zZWxlY3RlZENhdGVnb3J5LnZhbHVlLHRoaXMuc2VsZWN0ZWRDYXRlZ29yeS50eXBlKTtcbiAgICB9XG4gICAgdGhpcy5zZWxlY3RlZEZpbHRlclRhYlR5cGUxID0gdHlwZTtcbiAgfVxuXG4gIGlzRmlsdGVyRXhpc3RzKGZpbHRlcikge1xuICAgIGxldCBpbmR4ID0gXy5maW5kSW5kZXgodGhpcy5zZWxlY3RlZFZhbHVlcywoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PSBmaWx0ZXIgJiYgaXRlbS52YWx1ZTtcbiAgICB9KTtcbiAgICBpZihpbmR4ID4gLTEpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG5cbiAgc2VsZWN0RmlsdGVyKGl0ZW0sIHR5cGUpIHtcbiAgICBsZXQgdmFsdWUgPSB7XG4gICAgICB0eXBlIDogdHlwZSxcbiAgICAgIHZhbHVlOiBpdGVtXG4gICAgfTtcbiAgICBsZXQgaW5keCA9IF8uZmluZEluZGV4KHRoaXMuc2VsZWN0ZWRWYWx1ZXMsKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBpdGVtLnR5cGUgPT0gdHlwZTtcbiAgICB9KTtcblxuICAgIGlmKGluZHggPiAtMSkge1xuICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlc1tpbmR4XS52YWx1ZSA9IGl0ZW07XG4gICAgICB0aGlzLnNlbGVjdGVkQ2F0ZWdvcnkgPSB7dHlwZTp0eXBlLHZhbHVlOnRoaXMuc2VsZWN0ZWRWYWx1ZXNbaW5keF0udmFsdWV9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzLnB1c2godmFsdWUpO1xuICAgICAgdGhpcy5zZWxlY3RlZENhdGVnb3J5ID0ge3R5cGU6dHlwZSx2YWx1ZTppdGVtfTtcbiAgICB9XG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZFZhbHVlcyx0aGlzLnNlbGVjdGVkQ2F0ZWdvcnkpO1xuICB9XG5cblxuXG5cbiAgcmVzZXRBbGxGaWx0ZXJzKCkge1xuICAgIHRoaXMuZnJvbVRpbWUgPSBtb21lbnQoKS5zdWJ0cmFjdCgzLCAnaG91cnMnKS5mb3JtYXQoJ0xUJyk7XG4gICAgdGhpcy50b1RpbWUgPSBtb21lbnQoKS5mb3JtYXQoJ0xUJyk7XG4gICAgdGhpcy5pc0ZpbHRlcnNBcHBsaWVkID0gZmFsc2U7XG4gICAgdGhpcy50aW1lRmlsdGVyID0gZmFsc2U7XG4gICAgdGhpcy5vcGVuRmlsdGVyQmFyID0gZmFsc2U7XG4gICAgdGhpcy5zZWFyY2hLZXkgPSAnJztcbiAgICB0aGlzLmZpbHRlcktleXMgPSAnJztcbiAgICB0aGlzLmFsbEFwcGxpZWRGaWx0ZXJzID0ge307XG4gICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IFtdO1xuICAgIHRoaXMuc2VsZWN0ZWRGaWx0ZXJUYWJUeXBlMSA9IHRoaXMuZmlsdGVyS2V5czFbMF07XG4gICAgdGhpcy5zZWxlY3RlZENhdGVnb3J5ID0ge1xuICAgICAgdHlwZTonJyxcbiAgICAgIHZhbHVlOicnXG4gICAgfTtcbiAgICB0aGlzLmlzQ291bnRDbGlja2VkID0gZmFsc2U7XG4gICAgdGhpcy5maWx0ZXJDaGFuZ2UoKTtcbiAgfVxuXG4gIGZpbHRlckRhdGEoc2VhcmNoVmFsdWU/KSB7XG4gICAgdGhpcy5saXN0W3RoaXMuc2VsZWN0ZWRGaWx0ZXJUYWJUeXBlMV0gPSB0aGlzLmxpc3RDb3B5W3RoaXMuc2VsZWN0ZWRGaWx0ZXJUYWJUeXBlMV07IFxuICAgIGxldCBmaWx0ZXJBcnIgPSB0aGlzLmxpc3RbdGhpcy5zZWxlY3RlZEZpbHRlclRhYlR5cGUxXTtcbiAgICBpZiAoZmlsdGVyQXJyICYmIGZpbHRlckFyci5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGRhdGEgPSBmaWx0ZXJBcnIuZmlsdGVyKChpdGVtKSA9PiB7XG4gICAgICAgIHJldHVybiAoaXRlbS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoc2VhcmNoVmFsdWUudHJpbSgpLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2codGhpcy5zZWFyY2hLZXksc2VhcmNoVmFsdWUsXCJkYXRhPT5cIitkYXRhLHRoaXMubGlzdFt0aGlzLnNlbGVjdGVkRmlsdGVyVGFiVHlwZTFdKVxuICAgICAgdGhpcy5saXN0W3RoaXMuc2VsZWN0ZWRGaWx0ZXJUYWJUeXBlMV0gPSBbLi4uZGF0YV07XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==